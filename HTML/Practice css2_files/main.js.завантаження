function passAndHint(e){return setTimeout(function(){e.execCommand("autocomplete")},100),CodeMirror3.Pass}function myHint(e){return CodeMirror3.showHint(e,CodeMirror3.ternHint,{async:!0})}function betterTab(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection(e.getOption("indentWithTabs")?"	":Array(e.getOption("indentUnit")+1).join(" "),"end","+input")}function scrollToBottom(){1==stickyScroll?$("#preview").contents().scrollTop($("#preview").contents().height()):0==stickyScroll&&$("#preview").contents().scrollTo(0,0)}function autoRun(){0==autoRun?$("#run").hide():1==autoRun&&$("#run").show()}function getSelectedRange(){return{from:htmlEditor.getCursor(!0),to:htmlEditor.getCursor(!1)}}function autoFormatSelection(){var e=getSelectedRange();htmlEditor.autoFormatRange(e.from,e.to)}function getTitle(){var e=htmlEditor.getValue(),t=$.parseXML(e),o=$(t),n=o.find("title"),r=n.text();""==r||null==r?(alertify.alert("WARNING:<br/> Your weave has been saved, but your HTML is invalid and is missing the &lt;title&gt; tag!"),$("#dummy-title").val("A HTML5, CSS3 and JavaScript demo")):$("#dummy-title").val(r)}function downloadZip(){var e=new JSZip,t=htmlEditor.getValue(),o=cssEditor.getValue(),n=jsEditor.getValue(),r='<link type="text/css" rel="stylesheet" href="css/style.css"/>\n',i='<script type="text/javascript" src="js/script.js"></script>\n';r+="</head>",i+="</body>",t=t.replace("</head>",r),t=t.replace("</body>",i),e.file("css/style.css",o),e.file("js/script.js",n),e.file("index.html",t);var l=e.generate();location.href="data:application/zip;base64,"+l}function prevent(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function renderPreview(){var e=document.getElementById("preview"),t=e.contentDocument||e.contentWindow.document;t.open(),t.write('<style type="text/css">'+cssEditor.getValue()+"</style>"),t.write(htmlEditor.getValue()),t.write("<script>"+jsEditor.getValue()+"</script>"),t.close(),$("#preview").contents().find("a").click(function(e){e.preventDefault()})}var stickyScroll=1,autoRun=1,delay,htmlEditor=CodeMirror.fromTextArea(document.getElementById("html-source"),{mode:"pophtmlmixed",profile:"xhtml",lineWrapping:!0,lineNumbers:!0,gutters:["CodeMirror-lint-markers"],dragDrop:!0,theme:"tomorrow-night-eighties",extraKeys:{Tab:"betterTab","Ctrl-D":function(){downloadZip()},"Cmd-D":function(){downloadZip()},"Ctrl-R":function(){renderPreview()},"Cmd-R":function(){renderPreview()}}}),htmlCompletion=new CodeCompletion(htmlEditor,new HtmlCompletion);htmlEditor.setOption("onKeyEvent",function(e,t){return htmlCompletion.handleKeyEvent(e,t)}),htmlEditor.on("change",function(){1==autoRun&&(clearTimeout(delay),delay=setTimeout(renderPreview,300))}),htmlEditor.on("focus",function(){$(".html-logo").fadeOut("slow")}),htmlEditor.on("blur",function(){$(".html-logo").fadeIn("slow")}),htmlEditor.on("drop",function(){htmlEditor.setValue("")});var cssEditor=CodeMirror.fromTextArea(document.getElementById("css-source"),{mode:"css",lineWrapping:!0,dragDrop:!0,lineNumbers:!0,gutters:["CodeMirror-lint-markers"],lint:!0,theme:"tomorrow-night-eighties",extraKeys:{Tab:"betterTab","Ctrl-D":function(){downloadZip()},"Cmd-D":function(){downloadZip()},"Ctrl-R":function(){renderPreview()},"Cmd-R":function(){renderPreview()}}}),cssCompletion=new CodeCompletion(cssEditor,new CssCompletion);cssEditor.setOption("onKeyEvent",function(e,t){return cssCompletion.handleKeyEvent(e,t)}),cssEditor.on("change",function(){1==autoRun&&(clearTimeout(delay),delay=setTimeout(renderPreview,300))}),cssEditor.on("focus",function(){$(".css-logo").fadeOut("slow")}),cssEditor.on("blur",function(){$(".css-logo").fadeIn("slow")}),cssEditor.on("drop",function(){cssEditor.setValue("")}),CodeMirror3.commands.autocomplete=function(e){CodeMirror3.showHint(e,myHint)};var jsEditor=CodeMirror3.fromTextArea(document.getElementById("js-source"),{mode:"application/javascript",theme:"tomorrow-night-eighties",styleActiveLine:!0,lineNumbers:!0,autoCloseBrackets:!0,dragDrop:!0,matchBrackets:!0,lineWrapping:!0,extraKeys:{"'.'":passAndHint,"Ctrl-Space":passAndHint,Tab:"betterTab","Ctrl-D":function(){downloadZip()},"Cmd-D":function(){downloadZip()},"Ctrl-R":function(){renderPreview()},"Cmd-R":function(){renderPreview()}},gutters:["CodeMirror3-lint-markers","CodeMirror3-linenumbers"],lintWith:CodeMirror3.javascriptValidator,textHover:{delay:300},onKeyEvent:function(e,t){"keyup"==t.type&&(t.keyCode>=65&&t.keyCode<=90||190==t.keyCode)&&CodeMirror3.showHint(e,myHint)}});jsEditor.on("change",function(){1==autoRun&&(clearTimeout(delay),delay=setTimeout(renderPreview,300))}),jsEditor.on("focus",function(){$(".js-logo").fadeOut("slow")}),jsEditor.on("blur",function(){$(".js-logo").fadeIn("slow")}),jsEditor.on("drop",function(){jsEditor.setValue("")}),setTimeout(renderPreview,300),$("#tidy").click(function(){autoFormatSelection()});