(function(){var t,e,i;e=function(){function t(t){var e=this;this.element=$("#cm-suggestions"),this.element.length||this.create(),this.element.delegate("option","click",function(i){return e.element[0].selectedIndex=i.target.index,t.insert()}),$(document).unbind("click.completions").bind("click.completions",function(){return e.hide()})}return t.prototype.create=function(){return this.element=$("<select id='cm-suggestions'></select>"),$("body").append(this.element)},t.prototype.fill=function(t){var e,i,s,n,o,r;return n=function(){var i,n,h;for(h=[],i=0,n=t.length;n>i;i++)o=t[i],s=o.label||o.value||o,r=o.value||o,e=o.action||"",h.push("<option data-action='"+e+"' value='"+r+"'>"+s+"</option>");return h}(),i=this.element.html(n.join(""))[0],i.selectedIndex=0,i.size=Math.min(Math.max(2,n.length),10)},t.prototype.selected=function(){return this.element.val()},t.prototype.action=function(){var t;return t=this.element[0].selectedIndex,this.element.find("option").slice(t,t+1).data("action")},t.prototype.selectPrevious=function(){var t;return t=this.element[0],t.selectedIndex=t.selectedIndex<1?t.length-1:t.selectedIndex-1},t.prototype.selectNext=function(){return this.element[0].selectedIndex=(this.element[0].selectedIndex+1)%this.element[0].length},t.prototype.showAt=function(t){var e,i;return i={left:t.left,top:t.top},this.element.css(i),this.visible=!0,this.element.show(),e=this.element.outerHeight(),t.y+e>$(window).height()?this.element.css({top:t.y-this.element.outerHeight()-25}):void 0},t.prototype.hide=function(){return this.visible=!1,this.element.hide()},t.prototype._select=function(){},t}(),i=function(t){return CodeMirror.keyNames[t.keyCode]},t=function(){function t(t,i){this.editor=t,this.mode=i,this.widget=new e(this)}return t.prototype.suggest=function(){var t=this.editor.getCursor(),e=this.editor.cursorCoords(t);return this.editor.somethingSelected()?this.widget.hide():this.mode&&this.mode.hasHints(this.editor)?(this.hints=this.getHints(),this.hints?(this.widget.fill(this.hints.list),this.widget.showAt(e)):this.widget.hide()):this.widget.hide()},t.prototype.getHints=function(){var t;return t=this.mode&&this.mode.getHints(this.editor),t&&t.list&&t.list.length?1===t.list.length&&t.to.ch-t.from.ch===t.list[0].length?null:t:null},t.prototype.insert=function(){var t;if(this.widget.visible)return(t=this.widget.action())?this.mode&&this.mode[t](this.editor,this.widget.selected()):this.editor.replaceRange(this.widget.selected(),this.hints.from,this.hints.to),this.editor.focus()},t.prototype.autoQuote=function(t,e,i,s){var n,o,r,h;return i||(i=e),s||(s=i),n=this.editor.getCursor(),this.editor.somethingSelected()?(t.stop(),r=this.editor.getSelection(),void this.editor.replaceSelection(0===r.indexOf(i)&&r.match(new RegExp("\\"+s+"$"))?r.substr(1,r.length-2):[i,this.editor.getSelection(),s].join(""))):(o=this.editor.getRange(n,{line:n.line,ch:n.ch+1}),e===s&&o===s&&(t.stop(),this.editor.setCursor(n.line,n.ch+1)),o.match(/^\s?$/)?(h=this.editor.getTokenAt(n),h.string.match(new RegExp(".+\\"+s+"$"))?(t.stop(),this.editor.setCursor(n.line,n.ch+1)):-1===h.string.indexOf(s)?(this.editor.replaceRange(s,n),this.editor.setCursor(n)):void 0):void 0)},t.prototype.ignoreBracketIfClosed=function(t,e){var i,s;if(!this.editor.somethingSelected())return i=this.editor.getCursor(),s=this.editor.getRange(i,{line:i.line,ch:i.ch+1}),s===e?(t.stop(),this.editor.setCursor(i.line,i.ch+1)):void 0},t.prototype.keydown=function(t){var e;switch(e=i(t)){case"Up":if(this.widget.visible)return this.widget.selectPrevious(),!0;break;case"Down":if(this.widget.visible)return this.widget.selectNext(),!0;break;case"Enter":case"Tab":if(this.widget.visible)return this.insert(),this.suggest(),t.stop(),!0;if("Enter"===e&&this.mode&&this.mode.newline)return this.mode.newline(this.editor,t);break;case"Esc":if(this.widget.visible)return this.widget.hide(),!0}},t.prototype.keypress=function(t){switch(t.charCode){case 34:return this.autoQuote(t,'"');case 39:return this.editor.somethingSelected()?this.autoQuote(t,"'"):this.ignoreBracketIfClosed(t,"'");case 8216:return this.autoQuote(t,"‘","‘","’");case 8217:return this.ignoreBracketIfClosed(t,"’");case 8220:return this.autoQuote(t,"“","“","”");case 8221:return this.ignoreBracketIfClosed(t,"”");case 40:return this.autoQuote(t,"(","(",")");case 41:return this.ignoreBracketIfClosed(t,")");case 91:return this.autoQuote(t,"[","[","]");case 93:return this.ignoreBracketIfClosed(t,"]");case 123:return this.autoQuote(t,"{","{","}");case 125:return this.ignoreBracketIfClosed(t,"}");default:if(this.editor.somethingSelected())return;if(this.mode&&this.mode.autoInsertions)return this.mode.autoInsertions(this.editor,t)}},t.prototype.keyup=function(t){var e;if(e=i(t),"Enter"!==e){if("End"===e||"Home"===e&&this.widget.visible)return this.widget.hide();if("Left"===e||"Right"===e)return this.widget.hide();if(!("Space"!==e&&"Backspace"!==e&&t.keyCode<48))return this.suggest(this.editor)}},t.prototype.handleKeyEvent=function(t,e){return this[e.type]&&this[e.type](e)},t}(),window.CodeCompletion=t}).call(this);